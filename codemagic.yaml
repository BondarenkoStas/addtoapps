workflows:
    android-using-prebuilt-module:
      name: android_using_prebuilt_module
      environment:
        vars:
          CM_KEYSTORE: Encrypted(Z0FBQUFBQmVuZU9jUVV5Xy1FcE1xeGZPdTJWRkpZS1hQaml2M0pnYkg5ZWR0cjNmUTgwWnJBdmJVTG5lTGlWY3c5US1sQVBzOG9YdWpxM3k0THN5VDc3di02QnJtLTNQa0s5Zmh6MmlBRDBaZWtJTFZUWTlGZ25Oc0huOHRkWnJkaUtCTEl5TTRKS3hvMmljdm4yVXIza0FwS1RhaXpUT3BzZFM0ZjRLNlAySWxXZW9JMGZkaTNobWY5VzBGaE1JNG4xaUhTa1dVVFEyQ185bXRqMGJ5WHhpYzFPNWV2X25mcXBnU21ZVm5sc2RXQm1ZbmNScWwzWUlOU21FRHVJT3A1akVUU05STEFnamRtR05yV25ZS0dycGEtMnU5cmRjQXlfRFpJMG9TaG92VXpyX0U5MjJXR2huMjFWZDd5Mklub3llOWFhNGtuYTMzY1U0b2pjTXE1SzBVMTZnSXVjU296ZU81b3lRX1ozcnZDTWFGN29JZnlqNm52bWQyVmNZNjcyNTctNGVyZG1JVlo3blNjNm56NlpicWNYU1hKamxKc2hzWUE0UVhadVJ0SDNlZEE2dGxuQ2pXRmE3S3JmWXhxUVJCWVI4VGl2M0RZeXA4dGdEbnB1dEc4aGFyWmo2MzM1T1AtVVZXT3dZbC1fdXJFTkVTdmR4YlpLSGQ1cTJyRE5UT3NOdW5wUHctbjVVdHdNVHlIeGpab2xYY3BXNllzclFLU1lQUWdyT1FCLVRKS0VFdEVGMkVHYVh2ZG1OSElXdHkxZFhIMkxYVGlqV3E3dnQ3UnVCaUQ1SWNrTTBSWVUxUDRQOVBZSEphYnN2RkpsWHVLQkFVakdHa1B5NExLUEZXcklwanA4aTRhR3BNMHdYX1VGSFZUZlRTWGxCMWd1a25xY2ZBY045SjVTaTFpcDl1TXNhVW45NHp1RDNzdlJMY0dFdHlTU0FzZzAyR3dDS1J4eHZUX0dVT0I4aERrRmZIb0NralZqX3VhRzJLTGhVYTBhQzJxX1Jiem90ajZqV3cyZTJjSzc0Tm5PazRUMkM5YmtfNTg3Z3luRHFFNHRodUNDWWthYUl0YnRrZVNDTG0zYnZhWFR3Nzdzb3pwNDczU3p0Mk4zLWFBcFlscmEySzBKZWFlUEtOM3M1eWpUTmhfTzFkM3VOTHQxQURyXzlmQTRPQVFsSGNCZlVJLXhTZGNPNGtkclFtVU9RVFhVYlRoX1AxS3BaMWkzMmFFbmMwdmY4UjlsaEZCMTd1SE1rUHY5STRKVEFTaW0tM0hfM29fVmtXY3RrcUJCakZSU1NqbUJUQ3p2Zk1sZEdRdF9aUFVjdzlCUDFFT1BveDRnbnFZdmYyaDlGV3k3M3BJcTA0bmZLOGpMcUNpN2M5MERlUjBvc1VMd1lVOTBWMzEyMVFqLW85Y2lQeG01SHAtODlzalNrV0Jwb3BQWHdjN3dPUEk3WTRfcGdTdURyZ245OXBWNHJNWXBZRWFOLWFnQ1JxbzJzenZxTGluY2lzOUdldGxidWtGcnM4MTJna1Rrc19NZm10YUFDZTI4VlJrWWVmQy12a0Q1aVhfOGloYVFfWTZlT1h0eG02ZkxELUd3T1ptdTBud0J4dzdaVTNHRHoxcGRZdk1EZlVjUjcydjNGYlpCRFI3dnNYREkzY3Bwdk1MN1NzRlQtQTNBSU1VamZXdTlSZUJKSUg3QUFndU5ua2hMaFNISkNfZDE2b2F3MjN2Q3hpMHdmaWRQTVVzMVozdk9odllaLU1fNUZNVFJEdDFLdEMtYlJkRS1VcVljQ2JZSHduZnhWTUdsY2pJSnloT2toNTVXalEteGFaOEtPUl9wWDJvbXJyVHBMNVdDd1hBSndhYkVnUDRweWxmTXpFZFNrTU91QXFPWk8tRzR3Q1E3aHI3T2JXYk1CUEtyNjhwNlQzNVRqV3dZYUU3SlpLMFFLdmZrVTQ5VE1CeXhEd3lyRy1ZRmhJbW92RlBfS0Q0MzlWM2txazVzUUVUVGk5V2NxLVNKQ2ZZSGl2ZkU5SXFscHhyWkpVNFlGZml6RHlmak1la052TkF3M3pZRXFsSjFsTXRLYWx6dEpmbXhnN1RURDZLN3Vmdm9fenZRa1MwTldOSnhFcWFsRUVJR184bWk5a3hDbTFIZnI0VER0cmtsRzkzTndmNW8wWEMtZUlzNzIyLWtYaWhIU2llbUktendFNWdLQjV4YUVQU0s1TGJmS1pNREFTcGpydXRTTGtUTXVYcFgxM3g2aHF0R1hlVllNN3RDTEdFZUNYYmVGUHQ1T0NYU0ZqdWVWbEplUDZXYk8wTjJYdXp4U05jdE93ODFoR3hPbHlCLUN1dlpzNTludVJVdVlhbDZjTlBaaVlVUkk4bUQ2R3QtNVhwZUFnTjEzMkszYXdFaVRIR1dkdXh3cHp4QW92cUtXN2E4NktXYk5Vc0hSTEktazZ4Q1NCaEc3aGNJeW9wTTVlcW1VX0NBVVpKWmZOUEUzRVNZM0dVcXc2R2d0X3h2Rng4QWNjdDd3UzJhNTFrQTBnUWVmN3VXVUJkOEZCcFVCWTJBR2dkVFJaT2JjRFRMWFZVU2pxNG84Zml0TzBQbkRLZVRENkVSRm1pcUs5eUN0TkpQME5lSTF6ZWtwbXR2SzdmTUp2U3h1eGdkN0gzdzNtbWh1WEpjcF9LNEhwNkpCTlpqa1I0aUVNWTgwQ08wSnhsRElRRXNRZG1GaDMxaVQ1OTFjUnpxUDY1VGJ6cnQ0aXB4d2NKWXY1dkNBNW1NcDNJRktJY3FxOU1rS2dyYTBxNUk3U2JpT1hJRTRWekpHeFN3MHFzbl9GM3lIdFRhVEFSVU9OSEFmYTZtcThRSFBfcnI3RTNQZjk1Z3VUcVZQakhES2pDU2oxLUVnRzAyRTRFZlZqOWpBNHd4OUUyY2VVWHlRcExzUWVWcjJhNEU2UVppdkJXMlNoLTc5MEdRYWtZT0RXN2pzRlJ6UXJqMTBaai1kTVpqV2J5aVZLdVByWUFsa0dKczROeHlXb0hSRGRwdFRSbVBUc2JtVzR1NlE0ZWRJUHYzUms5WlhvMVdkcXRNMEc0aE1xQ0N0YlJxYS1oRmRDb2oxbnk0YlhzSk9PVHBaWDRUZ1BvTEFvX3RMbjVLUnVpdWl3N3FpQVg0T2Y1cFE3d211U3FEV05XNHJvdlVkQVIzTkkwX2MxNVVIckJWWDNoVlhCcXlDNmtSckhUTmhiQ3hnSHRGcmNkZlNhQmRCTjFhclV2U3VfRWNCaS1uWWZFTWVJMlpIY1hCV001aGNOZEIybEV4dGZqZy1BbXpfakstQkttT2NocS1tdzBPU1FSa0RJcm1wbkd4WGtiQTVEMDVqY0M1dkF1ek83R3NRZFVuR0JfXzdEN01uWlRLeTdnVm9odUNIbGFwRVN2RkRMVS12aEFIdjd3SVVjbjdYU19XTTZKcDFSVmNtSTQ0LUxNdTRkRlViaWNpa0tDdGlFWWtPY20wekp5b3hkMF93YTJUMkFNREF5WjB0SGdtMkFNTEc4NEQ2VWREMjRZdFpCWlJ3MU9uTWVKSEdFb1pPYXZvUmsycEgwQ1dWU2JhS3U1aUVxUVVfX3hCOHp4ekFISEdVTjBBSkZMMTFIbGp0MGxtVnFWNkJZamJvZFgzN2VialZvbDhIY2FZc2tJVmRDUTI0NHQ1eHctYkdaTTBhUllBRFBLRGpNei1BTG5LcGpreXdKWnphS2FjYi1WaUk2SHVkOWo2SlRqQjNHXzNiNms2SkxOeVNKQzVDZEU5NlRYTUh5SDFpeDkzNDNib0FSdmtEektHVGd0bHl2N2hYTGs4TEswdmxlNG5UQTBhYnFRYXJyTm5WeE1RNVhOSUx5Q004NWxJTEpiRkk4ZjlmZGhmUHVNUmRpZFBqT2F3QzBpdmh6RGpCN0lnY3NkcXRpZGNheGxCUUUyM1h5cDkxV1BLNU1WZEI0T0JKRkJHeFBaVlc1Sm9FUHVxS2s1MG1CdEt6TE5memc0dlhLNm4zUFdmak9TOTFpbEk5SV9XcnBYT2c1UlNvVmc3X1JLdmFVVWpDMzJSQi1oWUw4bUlVM0s1SkhGeE5BVEMzUFNJbUdHZ2FQZGdGS0U0blZiamxKV1RpYV9ZMlpLVDdJV2FUakxhclZnZUtZNXZJb3puWUF3SHhBekgwSGF4THRXa0dLbkZRU3dKUTFxc3JlR21OUjdnYVFUdkhVSEJfck1iUGpYSDZ4dlRyN29hbUJzTWN2X1ZBaVhBekZ3NDN4MjlaQnkxekl6MWVsQ2VtNzhsamtTdVZRc1BwQUNiTzBCbEdXanhDMWZoUjdWV3RYblNWbDBuNDZWajZsQTNQeTExSWJ4YkdYSlhrS1hLN3kzT2N5MXBlVGhoeTBaOTVQX0pvTTI0VlBoczlZVmZ5bXdMb3FCcnNScHBOenpmUnhKSkJXU2Q0cVl0Q2F2aU56UlA0UE9CNmU1U2xDVUw4SHFJX2w3Q1dxU3RxNDBpVkNoNmdsQ3djZWVWZW93RU9XQ0hDcWFYTk9pOHpPVl8xOGVyVlJ2OW9RdW1adDk0SDBObnZyNUVRVWVtblVYMUNWejBfeGtZLURDb1lQZmkySzMweVRIbU13WXV5T0p5d0U4VjVSTXVOT3BDS2p6a3ZCc2l2U2t1c2VMYmJnWmc2eUhKV1U4dThOcDRPcTJ6dnZvV2N5Njd3QnVTeXV1OHZzdFVOdEdNeENFVkZWZ3B2djRGZjBac2RrN2tzMUVrYWx5bW5qbVRwZ3lzTG9Pbjd0VkFaSDdESENYNUdyVFVtRDN6Y1k0RVJxbEhkSmd2VXZyNUt3NW43VXVFVmtYcmxMS3MwYU5ubVYxcGRTT2VuVGlZZUN6M19fejVNbVhoR0JvUjhsWkZrMEVhTDcxcWNuZjNlRlVEeTU3cVBnYzd0TVZTRm8wOWs4NkNGYk5hazMtTmJZNW1SVUVfbVVQYzV3cjNlOUJGVVlTbDlnWWN6LUxNY2o2bWVFTWx0cl9GdUFvbk04YmJ2a2s3eFc0NUg0WFFGcm1TRFhaMTE3cUV1cjdTVHNhOF9RVV92WEVvUmNWQkZ2QktlMkFCNGRFOHJ3RnZ0QlN1V3l1TjhSTFNwaEY3Ujl5anZLSm94RnhXNlJFOU1NRjVYekFLRGF6WnZjZDVXM2V1SUc4REh2RTlkWWJUb3k0WllsUnFFQ3NtSGFtT1hWNnRvbUZWNldkVFVHS3dPdDJlZHB0NE1TMTBHaVJfbDBmT3FvR2dNUUxYdG1pMWNuZHRsTTlCcWtYN3U5T0NtSGswcDh3VWU3YW9PWTh4THRfblg3Nm95b0ZHNzN5QXBsbHY5amVaVjQxbmJmVTZRU3FKUlVyak1hckp5QllYUHRYcmhDbmRXb3JPT3FoZUxpTWNrTnBzT3BsWDFMVk5kY2E3a3dWalBOcFJZNHBxaFV5eXBwcnl2SkM1U2VpVlNraUNFQzZXS1h2ek93WWJ3YXFfTXBUQkxfX3c1cWc9PQ==)
          CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmVuZU9jbXp3MDE2aG9WNW1LVzI2ZHRsZjNwc2hXaC1SQ1k0YWhsSHNBVldWWkdpZ19FZ2Y1cFpIZ0VZOFJ6QzZkMFl5aU1Jd3ppZUI4NGc3LVZRR2ZyV0dwdEE9PQ==)
          CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmVuZU9jX2liZUZtTkxVdlpqa1pRWFVBWWdVRzFHUXJyNkJJN08zLXFVYWJ6OWRLTnhmaHlsTF84b2duZlphMWlDWEs5enByWXZ3M25EOTh0cFR0UkgzMXVUQ3c9PQ==)
          CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmVuZU9jaUg1a05DRnJXZzRnTU5EbTFGZ3JwXzNudDR6ajNkZ3RZNDFEVW1CMkVNNGtWNWhrQThoYXVkWkJQRHlkdkxKMnBCbDVjaERnMHoycHBBTGdheGs0MHc9PQ==)
        flutter: stable
      triggering:
        events:
          - push
        branch_patterns:
          - pattern: 'android_using_prebuilt_module'
            include: true
            source: true
      scripts:
        - |
          # set up key.properties
          echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
          cat >> "$FCI_BUILD_DIR/android_using_plugin/key.properties" <<EOF
          storePassword=$CM_KEYSTORE_PASSWORD
          keyPassword=$CM_KEY_ALIAS_PASSWORD
          keyAlias=$CM_KEY_ALIAS_USERNAME
          storeFile=/tmp/keystore.keystore
          EOF
        - echo "sdk.dir=$HOME/programs/android-sdk-macosx" > "$FCI_BUILD_DIR/android_using_prebuilt_module/local.properties"
        - |
          cd flutter_module 
          flutter pub get
          flutter build aar
        - cd android_using_prebuilt_module && ./gradlew assembleRelease
      artifacts:
        - android_using_prebuilt_module/app/build/outputs/**/*.apk
        - android_using_prebuilt_module/app/build/outputs/**/**/*.apk
        - $FCI_BUILD_DIR/android_using_prebuilt_module/app/build/outputs/**/**/*.apk
